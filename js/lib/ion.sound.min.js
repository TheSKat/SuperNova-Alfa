(function(h,a,d,f){h.ion=h.ion||{};if(ion.sound){return}var p=function(u){if(!u){u="undefined"}if(h.console){if(console.warn&&typeof console.warn==="function"){console.warn(u)}else{if(console.log&&typeof console.log==="function"){console.log(u)}}var t=d&&d("#debug");if(t&&t.length){var i=t.html();t.html(i+u+"<br/>")}}};var o=function(i,u){var t;u=u||{};for(t in i){if(i.hasOwnProperty(t)){u[t]=i[t]}}return u};if(typeof Audio!=="function"&&typeof Audio!=="object"){var e=function(){p("HTML5 Audio is not supported in this browser")};ion.sound=e;ion.sound.play=e;ion.sound.stop=e;ion.sound.pause=e;ion.sound.preload=e;ion.sound.destroy=e;e();return}var b=/iPad|iPhone|iPod/.test(a.appVersion),k=0,q={},l={},m;if(!q.supported&&b){q.supported=["mp3","mp4","aac"]}else{if(!q.supported){q.supported=["mp3","ogg","mp4","aac","wav"]}}var r=function(t){var i=t.alias||t.name;if(!l[i]){l[i]=new n(t);l[i].init()}};ion.sound=function(i){o(i,q);q.path=q.path||"";q.volume=q.volume||1;q.preload=q.preload||false;q.allow_caching=q.allow_caching||false;q.multiplay=q.multiplay||false;q.loop=q.loop||false;q.sprite=q.sprite||null;q.scope=q.scope||null;q.ready_callback=q.ready_callback||null;q.ended_callback=q.ended_callback||null;k=q.sounds.length;if(!k){p("No sound-files provided!");return}for(m=0;m<k;m++){r(q.sounds[m])}};ion.sound.VERSION="3.0.7";ion.sound._method=function(u,t,i){if(t){l[t]&&l[t][u](i)}else{for(m in l){if(!l.hasOwnProperty(m)||!l[m]){continue}l[m][u](i)}}};ion.sound.preload=function(t,i){i=i||{};o({preload:true},i);ion.sound._method("init",t,i)};ion.sound.destroy=function(i){ion.sound._method("destroy",i);if(i){l[i]=null}else{for(m in l){if(!l.hasOwnProperty(m)){continue}if(l[m]){l[m]=null}}}};ion.sound.play=function(t,i){ion.sound._method("play",t,i)};ion.sound.stop=function(t,i){ion.sound._method("stop",t,i)};ion.sound.pause=function(t,i){ion.sound._method("pause",t,i)};ion.sound.volume=function(t,i){ion.sound._method("volume",t,i)};if(d){d.ionSound=ion.sound}var g=h.AudioContext||h.webkitAudioContext,s;if(g){s=new g()}var n=function(i){this.options=o(q);delete this.options.sounds;o(i,this.options);this.request=null;this.streams={};this.result={};this.ext=0;this.url="";this.loaded=false;this.decoded=false;this.no_file=false;this.autoplay=false};n.prototype={init:function(i){if(i){o(i,this.options)}if(this.options.preload){this.load()}},destroy:function(){var i;for(m in this.streams){i=this.streams[m];if(i){i.destroy();i=null}}this.streams={};this.result=null;this.options.buffer=null;this.options=null;if(this.request){this.request.removeEventListener("load",this.ready.bind(this),false);this.request.removeEventListener("error",this.error.bind(this),false);this.request.abort();this.request=null}},createUrl:function(){this.url=this.options.path+encodeURIComponent(this.options.name)+"."+this.options.supported[this.ext];if(!this.options.allow_caching){var i=new Date().valueOf();this.url+="?"+i}},load:function(){if(this.no_file){p('No sources for "'+this.options.name+'" sound :(');return}if(this.request){return}this.createUrl();this.request=new XMLHttpRequest();this.request.open("GET",this.url,true);this.request.responseType="arraybuffer";this.request.addEventListener("load",this.ready.bind(this),false);this.request.addEventListener("error",this.error.bind(this),false);this.request.send()},reload:function(){this.ext++;if(this.options.supported[this.ext]){this.load()}else{this.no_file=true;p('No sources for "'+this.options.name+'" sound :(')}},ready:function(i){this.result=i.target;if(this.result.readyState!==4){this.reload();return}if(this.result.status!==200&&this.result.status!==0){p(this.url+" was not found on server!");this.reload();return}this.request.removeEventListener("load",this.ready.bind(this),false);this.request.removeEventListener("error",this.error.bind(this),false);this.request=null;this.loaded=true;this.decode()},decode:function(){if(!s){return}s.decodeAudioData(this.result.response,this.setBuffer.bind(this),this.error.bind(this))},setBuffer:function(i){this.options.buffer=i;this.decoded=true;var t={name:this.options.name,alias:this.options.alias,ext:this.options.supported[this.ext],duration:this.options.buffer.duration};if(this.options.ready_callback&&typeof this.options.ready_callback==="function"){this.options.ready_callback.call(this.options.scope,t)}if(this.options.sprite){for(m in this.options.sprite){this.options.start=this.options.sprite[m][0];this.options.end=this.options.sprite[m][1];this.streams[m]=new c(this.options,m)}}else{this.streams[0]=new c(this.options)}if(this.autoplay){this.autoplay=false;this.play()}},error:function(){this.reload()},play:function(i){delete this.options.part;if(i){o(i,this.options)}if(!this.loaded){this.autoplay=true;this.load();return}if(this.no_file||!this.decoded){return}if(this.options.sprite){if(this.options.part){this.streams[this.options.part].play(this.options)}else{for(m in this.options.sprite){this.streams[m].play(this.options)}}}else{this.streams[0].play(this.options)}},stop:function(i){if(this.options.sprite){if(i){this.streams[i.part].stop()}else{for(m in this.options.sprite){this.streams[m].stop()}}}else{this.streams[0].stop()}},pause:function(i){if(this.options.sprite){if(i){this.streams[i.part].pause()}else{for(m in this.options.sprite){this.streams[m].pause()}}}else{this.streams[0].pause()}},volume:function(i){var t;if(i){o(i,this.options)}else{return}if(this.options.sprite){if(this.options.part){t=this.streams[this.options.part];t&&t.setVolume(this.options)}else{for(m in this.options.sprite){t=this.streams[m];t&&t.setVolume(this.options)}}}else{t=this.streams[0];t&&t.setVolume(this.options)}}};var c=function(i,t){this.alias=i.alias;this.name=i.name;this.sprite_part=t;this.buffer=i.buffer;this.start=i.start||0;this.end=i.end||this.buffer.duration;this.multiplay=i.multiplay||false;this.volume=i.volume||1;this.scope=i.scope;this.ended_callback=i.ended_callback;this.setLoop(i);this.source=null;this.gain=null;this.playing=false;this.paused=false;this.time_started=0;this.time_ended=0;this.time_played=0;this.time_offset=0};c.prototype={destroy:function(){this.stop();this.buffer=null;this.source=null;this.gain&&this.gain.disconnect();this.source&&this.source.disconnect();this.gain=null;this.source=null},setLoop:function(i){if(i.loop===true){this.loop=9999999}else{if(typeof i.loop==="number"){this.loop=+i.loop-1}else{this.loop=false}}},update:function(i){this.setLoop(i);if("volume" in i){this.volume=i.volume}},play:function(i){if(i){this.update(i)}if(!this.multiplay&&this.playing){return}this.gain=s.createGain();this.source=s.createBufferSource();this.source.buffer=this.buffer;this.source.connect(this.gain);this.gain.connect(s.destination);this.gain.gain.value=this.volume;this.source.onended=this.ended.bind(this);this._play()},_play:function(){var t,i;if(this.paused){t=this.start+this.time_offset;i=this.end-this.time_offset}else{t=this.start;i=this.end}if(i<=0){this.clear();return}if(typeof this.source.start==="function"){this.source.start(0,t,i)}else{this.source.noteOn(0,t,i)}this.playing=true;this.paused=false;this.time_started=new Date().valueOf()},stop:function(){if(this.playing&&this.source){if(typeof this.source.stop==="function"){this.source.stop(0)}else{this.source.noteOff(0)}}this.clear()},pause:function(){if(this.paused){this.play();return}if(!this.playing){return}this.source&&this.source.stop(0);this.paused=true},ended:function(){this.playing=false;this.time_ended=new Date().valueOf();this.time_played=(this.time_ended-this.time_started)/1000;this.time_offset+=this.time_played;if(this.time_offset>=this.end||this.end-this.time_offset<0.015){this._ended();this.clear();if(this.loop){this.loop--;this.play()}}},_ended:function(){var i={name:this.name,alias:this.alias,part:this.sprite_part,start:this.start,duration:this.end};if(this.ended_callback&&typeof this.ended_callback==="function"){this.ended_callback.call(this.scope,i)}},clear:function(){this.time_played=0;this.time_offset=0;this.paused=false;this.playing=false},setVolume:function(i){this.volume=i.volume;if(this.gain){this.gain.gain.value=this.volume}}};if(s){return}var j=function(){var x=new Audio(),t=x.canPlayType("audio/mpeg"),y=x.canPlayType("audio/ogg"),u=x.canPlayType('audio/mp4; codecs="mp4a.40.2"'),w,v;for(v=0;v<q.supported.length;v++){w=q.supported[v];if(!t&&w==="mp3"){q.supported.splice(v,1)}if(!y&&w==="ogg"){q.supported.splice(v,1)}if(!u&&w==="aac"){q.supported.splice(v,1)}if(!u&&w==="mp4"){q.supported.splice(v,1)}}x=null};j();n.prototype={init:function(i){if(i){o(i,this.options)}this.inited=true;if(this.options.preload){this.load()}},destroy:function(){var i;for(m in this.streams){i=this.streams[m];if(i){i.destroy();i=null}}this.streams={};this.loaded=false;this.inited=false},load:function(){var i;this.options.preload=true;this.options._ready=this.ready;this.options._scope=this;if(this.options.sprite){for(m in this.options.sprite){i=this.options.sprite[m];this.options.start=i[0];this.options.end=i[1];this.streams[m]=new c(this.options,m)}}else{this.streams[0]=new c(this.options)}},ready:function(t){if(this.loaded){return}this.loaded=true;var i={name:this.options.name,alias:this.options.alias,ext:this.options.supported[this.ext],duration:t};if(this.options.ready_callback&&typeof this.options.ready_callback==="function"){this.options.ready_callback.call(this.options.scope,i)}if(this.autoplay){this.autoplay=false;this.play()}},play:function(i){if(!this.inited){return}delete this.options.part;if(i){o(i,this.options)}if(!this.loaded){if(!this.options.preload){this.autoplay=true;this.load()}else{this.autoplay=true}return}if(this.options.sprite){if(this.options.part){this.streams[this.options.part].play(this.options)}else{for(m in this.options.sprite){this.streams[m].play(this.options)}}}else{this.streams[0].play(this.options)}},stop:function(i){if(!this.inited){return}if(this.options.sprite){if(i){this.streams[i.part].stop()}else{for(m in this.options.sprite){this.streams[m].stop()}}}else{this.streams[0].stop()}},pause:function(i){if(!this.inited){return}if(this.options.sprite){if(i){this.streams[i.part].pause()}else{for(m in this.options.sprite){this.streams[m].pause()}}}else{this.streams[0].pause()}},volume:function(i){var t;if(i){o(i,this.options)}else{return}if(this.options.sprite){if(this.options.part){t=this.streams[this.options.part];t&&t.setVolume(this.options)}else{for(m in this.options.sprite){t=this.streams[m];t&&t.setVolume(this.options)}}}else{t=this.streams[0];t&&t.setVolume(this.options)}}};c=function(i,t){this.name=i.name;this.alias=i.alias;this.sprite_part=t;this.multiplay=i.multiplay;this.volume=i.volume;this.preload=i.preload;this.allow_caching=i.allow_caching;this.path=q.path;this.start=i.start||0;this.end=i.end||0;this.scope=i.scope;this.ended_callback=i.ended_callback;this._scope=i._scope;this._ready=i._ready;this.setLoop(i);this.sound=null;this.url=null;this.loaded=false;this.start_time=0;this.paused_time=0;this.played_time=0;this.init()};c.prototype={init:function(){this.sound=new Audio();this.sound.volume=this.volume;this.createUrl();this.sound.addEventListener("ended",this.ended.bind(this),false);this.sound.addEventListener("canplaythrough",this.can_play_through.bind(this),false);this.sound.addEventListener("timeupdate",this._update.bind(this),false);this.load()},destroy:function(){this.stop();this.sound.removeEventListener("ended",this.ended.bind(this),false);this.sound.removeEventListener("canplaythrough",this.can_play_through.bind(this),false);this.sound.removeEventListener("timeupdate",this._update.bind(this),false);this.sound=null;this.loaded=false},createUrl:function(){var i=new Date().valueOf();this.url=this.path+encodeURIComponent(this.name)+"."+q.supported[0]+"?"+i},can_play_through:function(){if(this.preload){this.ready()}},load:function(){this.sound.src=this.url;this.sound.preload=this.preload?"auto":"none";if(this.preload){this.sound.load()}},setLoop:function(i){if(i.loop===true){this.loop=9999999}else{if(typeof i.loop==="number"){this.loop=+i.loop-1}else{this.loop=false}}},update:function(i){this.setLoop(i);if("volume" in i){this.volume=i.volume}},ready:function(){if(this.loaded||!this.sound){return}this.loaded=true;this._ready.call(this._scope,this.sound.duration);if(!this.end){this.end=this.sound.duration}},play:function(i){if(i){this.update(i)}if(!this.multiplay&&this.playing){return}this._play()},_play:function(){if(this.paused){this.paused=false}else{try{this.sound.currentTime=this.start}catch(i){}}this.playing=true;this.start_time=new Date().valueOf();this.sound.volume=this.volume;this.sound.play()},stop:function(){if(!this.playing){return}this.playing=false;this.paused=false;this.sound.pause();this.clear();try{this.sound.currentTime=this.start}catch(i){}},pause:function(){if(this.paused){this._play()}else{this.playing=false;this.paused=true;this.sound.pause();this.paused_time=new Date().valueOf();this.played_time+=this.paused_time-this.start_time}},_update:function(){if(!this.start_time){return}var u=new Date().valueOf(),i=u-this.start_time,t=(this.played_time+i)/1000;if(t>=this.end){if(this.playing){this.stop();this._ended()}}},ended:function(){if(this.playing){this.stop();this._ended()}},_ended:function(){this.playing=false;var i={name:this.name,alias:this.alias,part:this.sprite_part,start:this.start,duration:this.end};if(this.ended_callback&&typeof this.ended_callback==="function"){this.ended_callback.call(this.scope,i)}if(this.loop){setTimeout(this.looper.bind(this),15)}},looper:function(){this.loop--;this.play()},clear:function(){this.start_time=0;this.played_time=0;this.paused_time=0},setVolume:function(i){this.volume=i.volume;if(this.sound){this.sound.volume=this.volume}}}}(window,navigator,window.jQuery||window.$));