var unit_selected=null;function eco_struc_make_resource_row(b,a){var f,d;var c=Math.ceilVal(b[a]);var e=$("#unit_"+a);if(c>0){if(STACKABLE){c*=Math.roundVal($("#unit_amount").val())}f=Math.roundVal(planet[a])-c;d=f+Math.floatVal(planet[a+"_incoming"]);e.css({visibility:"visible",display:"table-row"});elementPrettyNumber($("#"+a+"_price"),c,planet[a]);elementPrettyNumber($("#"+a+"_left"),f);if(planet.fleet_own){elementPrettyNumber($("#"+a+"_fleet"),d);jQuery("#fleet_res").css("display","block")}else{$("#"+a+"_fleet").css("display","none")}}else{e.css("visibility","hidden")}}function eco_struc_make_resource_rows_all(a){eco_struc_make_resource_row(a,"metal");eco_struc_make_resource_row(a,"crystal");eco_struc_make_resource_row(a,"deuterium");eco_struc_make_resource_row(a,"dark_matter")}function buildUnitProcessResult(b,a){if(a){$("[name=action]").val(a);$("#form_unit").submit()}else{b.preventDefault()}return !!a}jQuery(document).ready(function(a){$("#unit_create_button_auto").on("click",function(c){var b=elementIsEnabled(this);if(b){if(DARK_MATTER>=MARKET_AUTOCONVERT_COST){if(confirm(language.eco_bld_autoconvert_explain+language.eco_bld_autoconvert_confirm)){b="create_autoconvert"}}else{alert(language.eco_bld_autoconvert_explain+language.eco_bld_autoconvert_dark_matter_none);b=false}}return buildUnitProcessResult(c,b)});$(".unit_create").on("click",function(c){var b=elementIsEnabled(this)||$(this).hasClass("icon_plus")||$(this).hasClass("icon_minus");if(b){b=$(this).hasClass("unit_create")?"create":"destroy"}return buildUnitProcessResult(c,b)});$(".unit_destroy").on("click",function(b){return buildUnitProcessResult(b,"destroy")});$("#form_unit").on("keypress",function(c){if(13!=c.which){return true}var b=$("#unit_create_button");if(!b.is("[disabled]")){b.click()}c.preventDefault();return false});$("#unit_amount").on("change",function(){$("#unit_create_button").button(Math.intVal($("#unit_amount").val())?"enable":"disable")});jQuery("#unit_amount").on("keyup change",function(c,d){var b=Math.intVal($("#unit_id").val());eco_struc_make_resource_rows_all(production[b])});jQuery("#unit_table").on("mouseenter","div[unit_id]",function(b,c){eco_struc_show_unit_info(jQuery(this).attr("unit_id"))}).on("mouseleave","div[unit_id]",function(b,c){if(unit_selected!=jQuery(this).attr("unit_id")){jQuery(this).removeClass("unit_border_selected")}}).on("click","div[unit_id]",function(b,c){eco_struc_select_unit(jQuery(this).attr("unit_id"))});$("#unit_info_extra_switch").on("click",function(){var b=$("#unit_balance");if(b.is(":visible")){$(this).children().html(language.eco_bld_unit_info_extra_show);b.hide()}else{$(this).children().html(language.eco_bld_unit_info_extra_hide);b.show()}});$("#auto_convert").on("change",function(){var c=$("#unit_create, #unit_create *");var d=$("#unit_create_button");c.prop("disabled",true);d.button("disable");unit_id=$("#unit_id").val();var b=production[unit_id];$("#unit_max_number").html(sn_format_number(b.can_build));if(b.autoconvert_amount){$("#auto_convert").prop("disabled",false).not(":checkbox").button("enable")}if(b.build_can!=0&&b.build_result==0){c.prop("disabled",false);$("#unit_amountslide").slider({max:b.can_build})}if(!$("#auto_convert").is(":disabled")&&$("#auto_convert").attr("aria-disabled")!="true"&&$("#auto_convert").is(":checked")){c.prop("disabled",false);$("#unit_amountslide").slider({max:b.autoconvert_amount});$("#unit_max_number").html(sn_format_number(b.autoconvert_amount))}else{if(b.build_can==0||b.build_result!=0){c.prop("disabled",true);$("#unit_amountslide").slider({max:0,value:0});d.button("disable");$("#unit_amount").val(0)}}if(b.autoconvert_amount){$("#auto_convert").prop("disabled",false).not(":checkbox").button("enable")}$("#unit_amount").change()});if(!planet.fleet_own){jQuery("[hide_no_fleet]").hide()}production_id_first?eco_struc_show_unit_info(production_id_first,true):""});var bld_unit_info_width=0;function extracted(a,b){switch(a){case"level":b+='<th class="c_l">'+language.level_short+"</th>";break;case"sys_metal":case"sys_crystal":case"sys_deuterium":case"sys_energy":case"sys_expeditions":case"sys_colonies":b+='<th class="c_c" colspan="2">'+language[a];break;case"metal_diff":case"crystal_diff":case"deuterium_diff":case"energy_diff":case"sys_expeditions_diff":case"sys_colonies_diff":b+="</th>";break}return b}function eco_struc_show_unit_info(e,n){if(!n){$("#unit"+e).addClass("unit_border_selected")}if(unit_selected){return}$("#unit_id").val(e);$("#unit_amountslide").slider({value:0,max:0});var l=production[e];var o="";var k="";var f=$("#unit_info_image");f.attr("src",l.image);$("#unit_info_wiki").attr("unit_id",e);$("#unit_info_description").html(l.description);$("#unit_time").html(l.time);$("#unit_time_div").css("display",l.time_seconds?"block":"none");$("#unit_info_name").html(l.name);if(l.level>0||STACKABLE){$("#unit_info_level").html((!STACKABLE?language.level+" ":"")+l.level+(Math.intVal(l.level_bonus)?'<span class="bonus">+'+l.level_bonus+"</span>":""))}else{$("#unit_info_level").html("&nbsp;")}if(STACKABLE){$("#unit_max").show();$("#unit_max_number").html(sn_format_number(l.can_build));$("#unit_max_number_autoconvert").html(sn_format_number(l.autoconvert_amount))}$("#unit_create, #unit_create *").prop("disabled",true);$("#unit_create_button").button("disable");$("#unit_destroy").css("visibility","hidden");var g;var c="";if(require[e]){for(d in require[e]){if(!require[e].hasOwnProperty(d)){continue}g=require[e][d];c=c+'<li class="'+(g.requerements_met?"positive":"negative  ")+'"><a href="infos.php?gid='+g.id+'" class="link">'+g.name+"</a>"+(!isNaN(g.level_basic)?" "+g.level_basic+(g.level_bonus?'<span class="bonus">+'+g.level_bonus+"</span>":"")+"/"+g.level_require:"")+"</li>"}$("#unit_require").empty().append(c);$("#unit_require_wrapper").show()}else{$("#unit_require_wrapper").hide()}if(grants[e]){c="";for(d in grants[e]){g=grants[e][d];c=c+'<li class="'+(g.requerements_met?"positive":"negative  ")+'">'+g.name+(!isNaN(g.level_basic)?" "+g.level_basic+(g.level_bonus?'<span class="bonus">+'+g.level_bonus+"</span>":"")+"/"+g.level_require:"")+"</li>"}$("#unit_grants").empty().append(c);$("#unit_grants_wrapper").show()}else{$("#unit_grants_wrapper").hide()}if(TEMPORARY){$("#unit_cost_table").hide()}else{$("#unit_cost_table").css("display","table");eco_struc_make_resource_rows_all(l);if(planet.que_has_place!=0&&!l.unit_busy){if(STACKABLE){$("#auto_convert").change();if(l.build_can!=0&&l.build_result==0){$("#unit_create, #unit_create *").prop("disabled",false);$("#unit_amountslide").slider({max:l.can_build})}}else{if(l.level>0&&l.destroy_can!=0&&l.destroy_result==0){$("#unit_destroy").css("visibility","visible");$("#unit_destroy_level").html(l.level);$("#unit_destroy_resources").html((l.destroy_metal?language.sys_metal[0]+": "+sn_format_number(l.destroy_metal,0,"positive")+" ":"")+(l.destroy_crystal?language.sys_crystal[0]+": "+sn_format_number(l.destroy_crystal,0,"positive")+" ":"")+(l.destroy_deuterium?language.sys_deuterium[0]+":"+sn_format_number(l.destroy_deuterium,0,"positive")+" ":""));$("#unit_destroy_time").html(l.destroy_time)}if((planet.fields_free>0||l.unit_type==UNIT_TECHNOLOGIES)&&l.build_can!=0&&l.build_result==0){$("#unit_create_button").button("enable");$("#unit_create, #unit_create *").prop("disabled",false)}}}}$("#unit_create_button_auto").button(l.can_autoconvert?"enable":"disable").prop("disabled",l.can_autoconvert?false:true);$("#unit_create_level, #unit_create_level_auto").html(l.level+1);var d,b,a;o="";if(l.resource_map){var h="";if(STACKABLE){for(d in l.resource_map[0]){if(!l.resource_map[0].hasOwnProperty(d)){continue}if(l.resource_map[0][d]){o+="<tr>";o+='<th class="c_l">'+language[d]+"</th>";o+='<td class="c_r">'+l.resource_map[0][d]+"</td>";o+="</tr>"}}}else{var m=false;for(d in l.resource_map){if(!l.resource_map.hasOwnProperty(d)){continue}o+='<tr class="c_r">';for(b in l.resource_map[d]){if(!l.resource_map[d].hasOwnProperty(b)||!l.resource_map[d][b]){continue}if(!m){h=extracted(b,h)}a=b=="level"?-l.level-l.level_bonus:(b.indexOf("diff")==-1?(l.resource_map[d-1]?-l.resource_map[d-1][b]:0):0);o+="<td>"+sn_format_number(Math.floatVal(l.resource_map[d][b]),0,"positive",a,l.resource_map[d][b]>0&&b.indexOf("diff")>=0)+"</td>"}o+="</tr>";m=true}}o?o=(h?"<tr>"+h+"</tr>":"")+o:false}!o?o='<tr><th class="c_c">'+language.eco_bld_unit_info_extra_none+"</th></tr>":false;$("#unit_balance").html('<table class="border_image_small">'+o+"</table>");$("<style></style>").appendTo($(document.body)).remove()}function eco_struc_select_unit(a){$("#unit_id").val(a);if(unit_selected==a){unit_selected=null}else{if(unit_selected){$("#unit"+unit_selected).removeClass("unit_border_selected");unit_selected=null;eco_struc_show_unit_info(a)}unit_selected=a;$("#unit_amountslide").slider({value:0})}}$(document).on("click","#eco_que_clear",function(a){snConfirm({that:$(this),message:language.eco_que_clear_dialog_text,title:language.eco_que_clear_dialog_title});return false});$(document).on("click","#eco_que_artifact",function(a){snConfirm({that:$(this),message:language.eco_que_artifact_dialog_text.format($(this).text()),title:language.eco_que_artifact_dialog_title.format($(this).text())});return false});